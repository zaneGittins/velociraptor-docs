<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.115.3"><meta name=description content><link rel=icon href=/images/favicon.png type=image/png><title>IRIS.Sync.Asset :: Velociraptor - Digging deeper!</title><link href=/css/nucleus.css?1689521255 rel=stylesheet><link href=/css/fontawesome-all.min.css?1689521255 rel=stylesheet><link href=/css/featherlight.min.css?1689521255 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1689521255 rel=stylesheet><link href=/css/auto-complete.css?1689521255 rel=stylesheet><link href=/css/theme.css?1689521255 rel=stylesheet><link href=/css/tabs.css?1689521255 rel=stylesheet><link href=/css/hugo-theme.css?1689521255 rel=stylesheet><link href=/css/theme-mine.css?1689521255 rel=stylesheet><link href=/css/dark.css?1689521255 rel=stylesheet><link href=/css/syntax.css?1689521255 rel=stylesheet><link href=/css/light.css?1689521255 rel=stylesheet><link href=/css/hljs.css?1689521255 rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css?1689521255 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1689521255></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYH72LMYCS"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYH72LMYCS",{anonymize_ip:!1})}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-QYH72LMYCS","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script></script></head><body data-url=/exchange/artifacts/pages/iris.sync.asset/><nav id=sidebar><div id=header-wrapper><div id=header><script>function darkmode(){$("body").addClass("dark").removeClass("light"),document.cookie="theme=darkmode;path=/"}function lightmode(){$("body").removeClass("dark").addClass("light"),document.cookie="theme=lightmode;path=/"}const regex=new RegExp("theme=darkmode");regex.test(document.cookie)?darkmode():lightmode()</script><div class="btn btn-default ThemeSelector darkmode" onclick=darkmode()><i class="fas fa-moon"></i></div><div class="btn btn-default ThemeSelector lightmode" onclick=lightmode()><i class="fas fa-sun"></i></div><a href=https://docs.velociraptor.app/><img src=https://docs.velociraptor.app//images/logo.svg></a></div></div><div class=highlightable><ul class=topics><li data-nav-id=https://docs.velociraptor.app/announcements/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/announcements/><i class="fas fa-bullhorn"></i>Announcements</a></div><ul><li data-nav-id=https://docs.velociraptor.app/announcements/2023-cves/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/announcements/2023-cves/>Current CVEs</a></div></li><li data-nav-id=https://docs.velociraptor.app/announcements/2023-trainings/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/announcements/2023-trainings/>Trainings</a></div></li><li data-nav-id=https://docs.velociraptor.app/announcements/2023-velocon/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/announcements/2023-velocon/>VeloCON 2023</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/><i class="fas fa-book-reader"></i>Documentation</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/overview/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/overview/>Velociraptor Overview</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/overview/history/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/history/>History</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/support/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/support/>Support Policy</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/deployment/>Deployment</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/deployment/self-signed/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/self-signed/>Self-Signed SSL</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/cloud/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/deployment/cloud/>Cloud Deployment</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/deployment/cloud/multifrontend/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/cloud/multifrontend/>Multi-Frontend</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/clients/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/clients/>Deploying Clients</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/rbac/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/rbac/>Users and Roles</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/resources/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/resources/>Performance</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/troubleshooting/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/troubleshooting/>Troubleshooting</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/references/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/references/>Config Reference</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/gui/>The Admin GUI</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/gui/clients/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/clients/>Inspecting clients</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/vfs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/vfs/>The VFS</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/artifacts/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/artifacts/>Artifacts</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/hunting/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/hunting/>Hunting</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/vql/>VQL Fundamentals</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/vql/notebooks/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/notebooks/>Notebooks</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/artifacts/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/artifacts/>Artifacts</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/events/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/events/>Event Queries</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/forensic/>Forensic Analysis</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/forensic/filesystem/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/filesystem/>Searching Filenames</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/searching/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/searching/>Searching Content</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/ntfs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/ntfs/>NTFS Analysis</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/binary/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/binary/>Binary parsing</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/evidence_of_execution/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/evidence_of_execution/>Evidence Of Execution</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/event_logs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/event_logs/>Event Logs</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/volatile/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/volatile/>Volatile State</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/offline_triage/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/offline_triage/>Triage and acquisition</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/offline_triage/remote_uploads/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/offline_triage/remote_uploads/>Remote Uploads</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/client_monitoring/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/client_monitoring/>Client Monitoring</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/extending_vql/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/extending_vql/>Extending VQL</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/server_automation/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/server_automation/>Server Automation</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/server_automation/server_api/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/server_automation/server_api/>Server API</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/server_automation/server_monitoring/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/server_automation/server_monitoring/>Server Monitoring</a></div></li></ul></li></ul></li><hr><li data-nav-id=https://docs.velociraptor.app/vql_reference/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/vql_reference/><i class="fas fa-book"></i>VQL Reference</a></div><ul><li data-nav-id=https://docs.velociraptor.app/vql_reference/basic/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/basic/>Basic VQL</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/linux/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/linux/>Linux Specific</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/windows/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/windows/>Windows Specific</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/parsers/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/parsers/>Parsers</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/server/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/server/>Server Side</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/plugin/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/plugin/>Client Side</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/event/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/event/>Event Plugins</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/experimental/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/experimental/>Experimental</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/misc/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/misc/>Misc</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/training/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/training/><i class="fas fa-graduation-cap"></i>Training</a></div></li><li data-nav-id=https://docs.velociraptor.app/blog/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/blog/><i class="fas fa-newspaper"></i>Blog</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/presentations/><i class="fas fa-chalkboard-teacher"></i>Presentations</a></div><ul><li data-nav-id=https://docs.velociraptor.app/presentations/2022_linuxconf_au/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_linuxconf_au/>Linux Conf Au 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_auscert/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_auscert/>Auscert 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_dfrws_us/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_dfrws_us/>DFRWS US 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_tech_user_group_cbr/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_tech_user_group_cbr/>Tech Users Group 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_sans_summit/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_sans_summit/>SANS Summit 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_velocon/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_velocon/>Velocon 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_dfrws_apac/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_dfrws_apac/>DFRWS APAC 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2023_everything_open/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2023_everything_open/>EverythingOpen 2023</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2023_auscert/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2023_auscert/>Auscert 2023</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/exchange/ class="dd-item parent haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/exchange/><i class="fas fa-code"></i>Artifact Exchange</a></div></li><li data-nav-id=https://docs.velociraptor.app/artifact_references/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/artifact_references/><i class="fas fa-book"></i>Artifact Reference</a></div></li><li data-nav-id=https://docs.velociraptor.app/knowledge_base/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/knowledge_base/><i class="fas fa-brain"></i>Knowledge Base</a></div></li><li data-nav-id=https://docs.velociraptor.app/search/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/search/><i class='fas fa-search'></i>Search</a></div></li></ul><hr><section id=shortcuts><h3></h3><ul><li><a class=padding href=https://github.com/Velocidex/velociraptor><i class='fab fa-github'></i>Github</a></li><li><a class=padding href=https://docs.velociraptor.app/discord/><i class='fab fa-discord'></i>Discord</a></li><li><a class=padding href=mailto:velociraptor-discuss@googlegroups.com><i class='fas fa-envelope'></i>Mailing List</a></li><li><a class=padding href=https://docs.velociraptor.app/rss/><i class='fas fa-rss'></i>RSS</a></li></ul></section><section id=footer><div class=footer-copyright>Brought to you by
<img src=/images/Rapid7_logo.svg class=rapid7><br><i class="fas fa-copyright"></i> 2022</div></section></div></nav><script>$("#sidebar i.fa-angle-right").each(function(){$(this).parent().parent().find("ul").hide()})</script><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title='Edit this page' href=https://github.com/Velocidex/velociraptor-docs/edit/master/content/exchange/artifacts/IRIS.Sync.Asset.yaml target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>IRIS.Sync.Asset</span></div><div class=progress><div class=wrapper><nav id=TableOfContents></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>IRIS.Sync.Asset</h1><p>This artifact synchronizes clients from Velociraptor to DFIR-IRIS (<a href=https://dfir-iris.org/)>https://dfir-iris.org/)</a>. It will parse available information of clients such as network interfaces, IP addresses, asset type and applied labels. Once it has been added, the asset ID from DFIR-IRIS will be added as client metadata and &lsquo;IRIS&rsquo; will be added as label. If this artifact is applied on a client that has the asset ID set in its metadata, it won&rsquo;t be readded but rather updated: Labels and the compromised status will by synchronized.</p><p>Tested with Dfir-Iris API v2.0.1</p><p><strong>Hints:</strong></p><ul><li>If it fails to add the client to IRIS, it will assign the &lsquo;IRIS-ERROR&rsquo; label to it. A successful run afterwards will remove it.</li><li>It is <strong>recommended</strong> to add the parameters with &lsquo;Iris&rsquo; prefix to the server metadata (via notebook) to ease the usage of the artifact:</li></ul><pre><code class=language-VQL>SELECT server_set_metadata(IrisURL=&quot;https://dfir-iris.local:4433&quot;,IrisKey=&quot;This-is-an_API_KEY&quot;,IrisCaseId=&quot;1&quot;,IrisRootCA='''-----BEGIN CERTIFICATE-----
&lt;...&gt;
-----END CERTIFICATE-----'''),server_metadata() FROM scope()
</code></pre><ul><li>You can define the compromise status of a system when creating and when updating the information. <strong>However, if an asset is categorized as <em>compromised</em>, you cannot change the status using this artifact.</strong> This is a safety measure to mitigate a potential high impact error. Beside that, you can freely change the status between <em>No</em>, <em>Unknown</em> and <em>To be determined</em>.</li><li>The true power of this artifact lies in the ability to quickly add many clients to DFIR-IRIS. As it is usually not needed to add all clients that are enrolled in Velociraptor to IRIS but rather an excerpt of important, suspicious, or compromised systems, you will <strong>most likely use this artifact from within a notebook</strong>.</li></ul><p><strong>Example</strong> to add just a few systems and have the results of the operation as JSON:</p><pre><code class=language-VQL>SELECT client_id,{SELECT * FROM Artifact.Exchange.IRIS.Sync.Asset(clientId=client_id,isCompromised=&quot;Y&quot;)} FROM clients(search=&quot;label:compromised&quot;)
</code></pre><p><strong>Example</strong> to add many systems in a performant way and have the results in well-structured columns. <strong>ATTENTION: ALWAYS USE ASYNC=FALSE IF CLIENTS ARE PRESENT IN THE TABLE MULTIPLE TIMES! OTHERWISE THESE ASSETS MIGHT BE DUPLICATED IN IRIS!!!</strong></p><pre><code class=language-VQL>SELECT * FROM foreach(row={SELECT * FROM clients(search=&quot;label:suspicious&quot;)},query={SELECT * FROM Artifact.Exchange.IRIS.Sync.Asset(clientId=client_id,isCompromised=&quot;UNK&quot;)},async=true)
</code></pre><pre><code class=language-yaml>name: IRIS.Sync.Asset
author: Stephan Mikiss @stephmikiss (SEC Defence @SEC Consult)
description: |
   This artifact synchronizes clients from Velociraptor to DFIR-IRIS (https://dfir-iris.org/). It will parse available information of clients such as network interfaces, IP addresses, asset type and applied labels. Once it has been added, the asset ID from DFIR-IRIS will be added as client metadata and 'IRIS' will be added as label. If this artifact is applied on a client that has the asset ID set in its metadata, it won't be readded but rather updated: Labels and the compromised status will by synchronized.
   
   Tested with Dfir-Iris API v2.0.1
   
   **Hints:**
   
   - If it fails to add the client to IRIS, it will assign the 'IRIS-ERROR' label to it. A successful run afterwards will remove it.
   - It is **recommended** to add the parameters with 'Iris' prefix to the server metadata (via notebook) to ease the usage of the artifact:
   
   ```VQL
   SELECT server_set_metadata(IrisURL=&quot;https://dfir-iris.local:4433&quot;,IrisKey=&quot;This-is-an_API_KEY&quot;,IrisCaseId=&quot;1&quot;,IrisRootCA='''-----BEGIN CERTIFICATE-----
   &lt;...&gt;
   -----END CERTIFICATE-----'''),server_metadata() FROM scope()
</code></pre><ul><li>You can define the compromise status of a system when creating and when updating the information. <strong>However, if an asset is categorized as <em>compromised</em>, you cannot change the status using this artifact.</strong> This is a safety measure to mitigate a potential high impact error. Beside that, you can freely change the status between <em>No</em>, <em>Unknown</em> and <em>To be determined</em>.</li><li>The true power of this artifact lies in the ability to quickly add many clients to DFIR-IRIS. As it is usually not needed to add all clients that are enrolled in Velociraptor to IRIS but rather an excerpt of important, suspicious, or compromised systems, you will <strong>most likely use this artifact from within a notebook</strong>.</li></ul><p><strong>Example</strong> to add just a few systems and have the results of the operation as JSON:</p><pre><code class=language-VQL>SELECT client_id,{SELECT * FROM Artifact.Exchange.IRIS.Sync.Asset(clientId=client_id,isCompromised=&quot;Y&quot;)} FROM clients(search=&quot;label:compromised&quot;)
</code></pre><p><strong>Example</strong> to add many systems in a performant way and have the results in well-structured columns. <strong>ATTENTION: ALWAYS USE ASYNC=FALSE IF CLIENTS ARE PRESENT IN THE TABLE MULTIPLE TIMES! OTHERWISE THESE ASSETS MIGHT BE DUPLICATED IN IRIS!!!</strong></p><pre><code class=language-VQL>SELECT * FROM foreach(row={SELECT * FROM clients(search=&quot;label:suspicious&quot;)},query={SELECT * FROM Artifact.Exchange.IRIS.Sync.Asset(clientId=client_id,isCompromised=&quot;UNK&quot;)},async=true)
</code></pre><h1 id=can-be-client-client_event-server-server_event>Can be CLIENT, CLIENT_EVENT, SERVER, SERVER_EVENT</h1><p>type: SERVER</p><p>parameters:</p><ul><li>name: clientId
description: Client Id of the client that should be synced to DFIR-IRIS</li><li>name: isCompromised
default: TBD
description: Specify whether this asset should be marked as compromised in IRIS using &ldquo;Y&rdquo; (compromised), &ldquo;N&rdquo; (not compromised), &ldquo;TBD&rdquo; (to be determined), or &ldquo;UNK&rdquo; (unknown).
type: choices
choices:<ul><li>Y</li><li>N</li><li>TBD</li><li>UNK</li></ul></li><li>name: labelIgnoreListRegex
default: &ldquo;IRIS|^Workstation$|^Server$|^Domain Controller$|^Linux$&rdquo;
description: Labels that should be ignored and not added to IRIS</li><li>name: IrisURL
description: URL of DFIR-IRIS. Preferred method is to use the server metadata</li><li>name: IrisKey
description: API Key of DFIR-IRIS. Preferred method is to use the server metadata</li><li>name: IrisCaseId
description: Case ID of the current case. Preferred method is to use the server metadata</li><li>name: IrisRootCA
description: RootCA of DFIR-IRIS for self-signed or internal certificates of DFIR-IRIS. Preferred over completely skipping SSL verification.</li><li>name: DisableSSLVerify
default: false
description: Disable TLS verification for HTTPS request to DFIR-IRIS.</li></ul><p>sources:</p><ul><li><p>query: |</p><p>LET URL &lt;= if(
condition=IrisURL,
then=IrisURL,
else=server_metadata().IrisURL)
LET Creds = if(
condition=IrisKey,
then=IrisKey,
else=server_metadata().IrisKey)
LET CaseID &lt;= if(
condition=IrisCaseId,
then=IrisCaseId,
else=server_metadata().IrisCaseId)
LET RootCA &lt;= if(
condition=IrisRootCA,
then=IrisRootCA,
else=server_metadata().IrisRootCA)</p><p>LET AssetType = SELECT * FROM switch(
a = {SELECT {
SELECT if(condition = <code>Computer Info</code>.DomainRole =~ &ldquo;Workstation&rdquo;,
then = 9,
else = if(condition= <code>Computer Info</code>.DomainRole =~ &ldquo;Server&rdquo;,
then = 10,
else = if(condition= <code>Computer Info</code>.DomainRole =~ &ldquo;Domain Controller&rdquo;,
then = 11
)))
FROM flow_results(client_id=clientId,flow_id=last_interrogate_flow_id,artifact=&ldquo;Generic.Client.Info/WindowsInfo&rdquo;)
} as AssetTypeId
FROM clients(client_id=clientId)
WHERE os_info.system =~ &ldquo;windows&rdquo;
},
b = {SELECT 3 as AssetTypeId
FROM clients(client_id=clientId)
WHERE os_info.system =~ &ldquo;linux&rdquo;})</p><p>LET resolveIPs = SELECT
{SELECT <code>Network Info</code> FROM flow_results(client_id=clientId,flow_id=last_interrogate_flow_id,artifact=&ldquo;Generic.Client.Info/WindowsInfo&rdquo;)} as NetworkInfo
FROM clients(client_id=clientId)</p><p>LET primaryIP = SELECT parse_string_with_regex(string=if(condition=NetworkInfo[0],then=NetworkInfo[0].IPAddresses,else=NetworkInfo.IPAddresses),regex="(?P<ip>[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3})").IP as PrimaryIPv4Address FROM resolveIPs
LET networkInterfaces = SELECT parse_string_with_regex(string=NetworkInfo.Caption,regex="^\[.<em>\] (?P<if>.</em>)").IF as NetworkInterface,
NetworkInfo.IPAddresses as IPAddresses, NetworkInfo.MACAddress as MACAddress FROM flatten(query=resolveIPs)
LET networkInterfacesDescription = SELECT join(array=array(a1={
SELECT format(format="%v (%v): %v",args=[NetworkInterface,MACAddress,IPAddresses]) FROM networkInterfaces}),
sep="\n") as NetworkInfo FROM scope()</p><p>LET labelToTags = join(array=array(a1={SELECT _value FROM foreach(row=labels) WHERE NOT _value =~ labelIgnoreListRegex}),sep=",")</p><p>LET metadata_preparation = SELECT client_metadata(client_id=clientId) as metadata FROM scope() WHERE metadata.IRIS_AssetId
LET assetId = SELECT metadata_preparation.metadata[0].IRIS_AssetId as assetId FROM scope()
LET addMetadata(assetIdValue) = SELECT client_set_metadata(client_id=clientId,metadata=client_metadata(client_id=clientId) + dict(IRIS_AssetId=assetIdValue)),
client_metadata(client_id=clientId) FROM scope()</p><p>LET assetProperties = serialize(
item=dict(
asset_name=format(format="%v",args=[os_info.hostname]),
asset_type_id=AssetType.AssetTypeId[0],
analysis_status_id=1,
asset_compromise_status_id=if(condition=isCompromised=~"^Y$",then=1,else=if(condition=isCompromised=~"^N$",then=2,else=if(condition=isCompromised=~"^UNK$",then=3,else=0))),
asset_domain=format(format="%v",args=[join(array=slice(list=split(sep_string=".",string=os_info.fqdn),start=1,end=-1),sep=".")]),
asset_ip=format(format="%v",args=[primaryIP.PrimaryIPv4Address]),
asset_tags=if(condition=labelToTags,then=format(format=&ldquo;Velo,%v&rdquo;,args=[labelToTags]),else=&ldquo;Velo&rdquo;),
asset_description=format(format=&ldquo;Velo ClientId: %v\nVelo Agent First seen: %v\nAsset added to IRIS by Velo: %v\nNetwork Info:\n%v&rdquo;, args=[client_id,timestamp(epoch=first_seen_at),timestamp(epoch=now()),networkInterfacesDescription.NetworkInfo[0]])
)
,format=&ldquo;json&rdquo;
)</p><p>LET apiRequestIrisAdd = if(condition=config.version.version &lt; &ldquo;0.6.9&rdquo;,
then={ SELECT *,if(condition=parse_json(data=Content).data.asset_id,
then={SELECT addMetadata(assetIdValue=format(format="%v",args=parse_json(data=Content).data.asset_id)),
label(client_id=clientId,op=&ldquo;set&rdquo;,labels=&ldquo;IRIS&rdquo;),
label(client_id=clientId,op=&ldquo;remove&rdquo;,labels=&ldquo;IRIS-ERROR&rdquo;)
FROM scope()},
else={SELECT label(client_id=clientId,op=&ldquo;set&rdquo;,labels=&ldquo;IRIS-ERROR&rdquo;) FROM scope()}) as applyLabels
FROM http_client(
data=assetProperties,
headers=dict(<code>Content-Type</code>=&ldquo;application/json&rdquo;, <code>Authorization</code>=format(format=&ldquo;Bearer %v&rdquo;, args=[Creds])),
disable_ssl_security=DisableSSLVerify,
root_ca=RootCA,
method=&ldquo;POST&rdquo;,
url=format(format="%v/case/assets/add?cid=%v", args=[URL,CaseID])) },
else={ SELECT *,if(condition=parse_json(data=Content).data.asset_id,
then={SELECT addMetadata(assetIdValue=format(format="%v",args=parse_json(data=Content).data.asset_id)),
label(client_id=clientId,op=&ldquo;set&rdquo;,labels=&ldquo;IRIS&rdquo;),
label(client_id=clientId,op=&ldquo;remove&rdquo;,labels=&ldquo;IRIS-ERROR&rdquo;)
FROM scope()},
else={SELECT label(client_id=clientId,op=&ldquo;set&rdquo;,labels=&ldquo;IRIS-ERROR&rdquo;) FROM scope()}) as applyLabels
FROM http_client(
data=assetProperties,
headers=dict(<code>Content-Type</code>=&ldquo;application/json&rdquo;, <code>Authorization</code>=format(format=&ldquo;Bearer %v&rdquo;, args=[Creds])),
skip_verify=DisableSSLVerify,
root_ca=RootCA,
method=&ldquo;POST&rdquo;,
url=format(format="%v/case/assets/add?cid=%v", args=[URL,CaseID])) })</p><p>LET apiRequestIrisGet(assetId) = if(condition=config.version.version &lt; &ldquo;0.6.9&rdquo;,
then={ SELECT parse_json(data=Content),parse_json(data=Content).data.asset_name as asset_name,parse_json(data=Content).data.asset_type_id as asset_type_id,
parse_json(data=Content).data.analysis_status_id as analysis_status_id,parse_json(data=Content).data.asset_tags as asset_tags,
parse_json(data=Content).data.linked_ioc as linked_ioc,parse_json(data=Content).data.custom_attributes as custom_attributes,
parse_json(data=Content).data.asset_compromise_status_id as asset_compromise_status_id
FROM http_client(
headers=dict(<code>Content-Type</code>=&ldquo;application/json&rdquo;, <code>Authorization</code>=format(format=&ldquo;Bearer %v&rdquo;, args=[Creds])),
disable_ssl_security=DisableSSLVerify,
root_ca=RootCA,
method=&ldquo;GET&rdquo;,
url=format(format="%v/case/assets/%v?cid=%v", args=[URL,assetId,CaseID])) },
else={ SELECT parse_json(data=Content),parse_json(data=Content).data.asset_name as asset_name,parse_json(data=Content).data.asset_type_id as asset_type_id,
parse_json(data=Content).data.analysis_status_id as analysis_status_id,parse_json(data=Content).data.asset_tags as asset_tags,
parse_json(data=Content).data.linked_ioc as linked_ioc,parse_json(data=Content).data.custom_attributes as custom_attributes,
parse_json(data=Content).data.asset_compromise_status_id as asset_compromise_status_id
FROM http_client(
headers=dict(<code>Content-Type</code>=&ldquo;application/json&rdquo;, <code>Authorization</code>=format(format=&ldquo;Bearer %v&rdquo;, args=[Creds])),
skip_verify=DisableSSLVerify,
root_ca=RootCA,
method=&ldquo;GET&rdquo;,
url=format(format="%v/case/assets/%v?cid=%v", args=[URL,assetId,CaseID])) })</p><p>LET assetPropertiesUpdate = serialize(
item=dict(
asset_name=currentAsset.asset_name[0],
asset_type_id=currentAsset.asset_type_id[0],
analysis_status_id=currentAsset.analysis_status_id[0],
asset_compromise_status_id=if(condition=isCompromised=~"^Y$",then=1,else=if(condition=currentAsset.asset_compromise_status_id[0]=1,then=1,else=if(condition=isCompromised=~"^N$",then=2,else=if(condition=isCompromised=~"^UNK$",then=3,else=if(condition=isCompromised=~"^TBD$",then=0,else=currentAsset.asset_compromise_status_id[0]))))),
asset_tags=if(condition=labelToTags,then=format(format=&ldquo;Velo,%v&rdquo;,args=[labelToTags]),else=&ldquo;Velo&rdquo;)
)
,format=&ldquo;json&rdquo;
)</p><p>LET apiRequestIrisUpdate(currentAsset,assetId) = if(condition=config.version.version &lt; &ldquo;0.6.9&rdquo;,
then={ SELECT *,if(condition= Response=200,
then={SELECT addMetadata(assetIdValue=format(format="%v",args=parse_json(data=Content).data.asset_id)),
label(client_id=clientId,op=&ldquo;set&rdquo;,labels=&ldquo;IRIS&rdquo;),
label(client_id=clientId,op=&ldquo;remove&rdquo;,labels=&ldquo;IRIS-ERROR&rdquo;)
FROM scope()},
else={SELECT label(client_id=clientId,op=&ldquo;set&rdquo;,labels=&ldquo;IRIS-ERROR&rdquo;) FROM scope()}) as applyLabels
FROM http_client(
data=assetPropertiesUpdate,
headers=dict(<code>Content-Type</code>=&ldquo;application/json&rdquo;, <code>Authorization</code>=format(format=&ldquo;Bearer %v&rdquo;, args=[Creds])),
disable_ssl_security=DisableSSLVerify,
root_ca=RootCA,
method=&ldquo;POST&rdquo;,
url=format(format="%v/case/assets/update/%v?cid=%v", args=[URL,assetId,CaseID])) },
else={ SELECT *,if(condition= Response=200,
then={SELECT addMetadata(assetIdValue=format(format="%v",args=parse_json(data=Content).data.asset_id)),
label(client_id=clientId,op=&ldquo;set&rdquo;,labels=&ldquo;IRIS&rdquo;),
label(client_id=clientId,op=&ldquo;remove&rdquo;,labels=&ldquo;IRIS-ERROR&rdquo;)
FROM scope()},
else={SELECT label(client_id=clientId,op=&ldquo;set&rdquo;,labels=&ldquo;IRIS-ERROR&rdquo;) FROM scope()}) as applyLabels
FROM http_client(
data=assetPropertiesUpdate,
headers=dict(<code>Content-Type</code>=&ldquo;application/json&rdquo;, <code>Authorization</code>=format(format=&ldquo;Bearer %v&rdquo;, args=[Creds])),
skip_verify=DisableSSLVerify,
root_ca=RootCA,
method=&ldquo;POST&rdquo;,
url=format(format="%v/case/assets/update/%v?cid=%v", args=[URL,assetId,CaseID])) })</p><p>LET addAsset = SELECT {SELECT * FROM apiRequestIrisAdd} as apiRequestIrisAdd FROM clients(client_id=clientId)
LET updateAsset = SELECT {SELECT * FROM apiRequestIrisUpdate(currentAsset=apiRequestIrisGet(assetId=client_metadata(client_id=clientId).IRIS_AssetId),assetId=client_metadata(client_id=clientId).IRIS_AssetId)} as apiRequestIrisUpdate FROM clients(client_id=clientId)</p><p>SELECT * FROM if(condition= metadata_preparation,
then = {SELECT &ldquo;Already Added -> Update labels and compromise status in IRIS&rdquo; as Action,if(condition= apiRequestIrisUpdate.Response=200,then=&ldquo;SUCCESS&rdquo;,else=&ldquo;ERROR&rdquo;) as Result,
parse_json(data=apiRequestIrisUpdate.Content).data as AssetProperties,
apiRequestIrisUpdate.applyLabels[0].<code>addMetadata(assetIdValue=format(format="%v", args=parse_json(data=Content).data.asset_id))</code>[0].<code>client_metadata(client_id=clientId)</code>.IRIS_AssetId as IRIS_AssetId,
apiRequestIrisUpdate as _rawEvent FROM updateAsset},
else = { SELECT &ldquo;Needs to be added&rdquo; as Action, if(condition= apiRequestIrisAdd.Response=200,then=&ldquo;SUCCESS&rdquo;,else=&ldquo;ERROR&rdquo;) as Result,
parse_json(data=apiRequestIrisAdd.Content).data as AssetProperties,
apiRequestIrisAdd.applyLabels[0].<code>addMetadata(assetIdValue=format(format="%v", args=parse_json(data=Content).data.asset_id))</code>[0].<code>client_metadata(client_id=clientId)</code>.IRIS_AssetId as IRIS_AssetId,
apiRequestIrisAdd as _rawEvent FROM addAsset})</p></li></ul><pre><code></code></pre><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1689521255></script>
<script src=/js/perfect-scrollbar.min.js?1689521255></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1689521255></script>
<script src=/js/jquery.sticky.js?1689521255></script>
<script src=/js/featherlight.min.js?1689521255></script>
<script src=/js/highlight.min.js?1689521255></script>
<script>hljs.highlightAll()</script><script src=/js/modernizr.custom-3.6.0.js?1689521255></script>
<script src=/js/learn.js?1689521255></script>
<script src=/js/hugo-learn.js?1689521255></script></body></html>
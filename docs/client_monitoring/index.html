<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.111.3"><meta name=description content><link rel=icon href=/images/favicon.png type=image/png><title>Client Monitoring :: Velociraptor - Digging deeper!</title><link href=/css/nucleus.css?1683470635 rel=stylesheet><link href=/css/fontawesome-all.min.css?1683470635 rel=stylesheet><link href=/css/featherlight.min.css?1683470635 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1683470635 rel=stylesheet><link href=/css/auto-complete.css?1683470635 rel=stylesheet><link href=/css/theme.css?1683470635 rel=stylesheet><link href=/css/tabs.css?1683470635 rel=stylesheet><link href=/css/hugo-theme.css?1683470635 rel=stylesheet><link href=/css/theme-mine.css?1683470635 rel=stylesheet><link href=/css/dark.css?1683470635 rel=stylesheet><link href=/css/syntax.css?1683470635 rel=stylesheet><link href=/css/light.css?1683470635 rel=stylesheet><link href=/css/hljs.css?1683470635 rel=stylesheet><link href=https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css?1683470635 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1683470635></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script async src="https://www.googletagmanager.com/gtag/js?id=G-QYH72LMYCS"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QYH72LMYCS",{anonymize_ip:!1})}</script><script type=application/javascript>var doNotTrack=!1;doNotTrack||(window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","G-QYH72LMYCS","auto"),ga("send","pageview"))</script><script async src=https://www.google-analytics.com/analytics.js></script>
<script></script></head><body data-url=/docs/client_monitoring/><nav id=sidebar><div id=header-wrapper><div id=header><script>function darkmode(){$("body").addClass("dark").removeClass("light"),document.cookie="theme=darkmode;path=/"}function lightmode(){$("body").removeClass("dark").addClass("light"),document.cookie="theme=lightmode;path=/"}const regex=new RegExp("theme=darkmode");regex.test(document.cookie)?darkmode():lightmode()</script><div class="btn btn-default ThemeSelector darkmode" onclick=darkmode()><i class="fas fa-moon"></i></div><div class="btn btn-default ThemeSelector lightmode" onclick=lightmode()><i class="fas fa-sun"></i></div><a href=https://docs.velociraptor.app/><img src=https://docs.velociraptor.app//images/logo.svg></a></div></div><div class=highlightable><ul class=topics><li data-nav-id=https://docs.velociraptor.app/announcements/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/announcements/><i class="fas fa-bullhorn"></i>Announcements</a></div><ul><li data-nav-id=https://docs.velociraptor.app/announcements/2023-cves/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/announcements/2023-cves/>Current CVEs</a></div></li><li data-nav-id=https://docs.velociraptor.app/announcements/2023-trainings/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/announcements/2023-trainings/>Trainings</a></div></li><li data-nav-id=https://docs.velociraptor.app/announcements/2023-velocon/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/announcements/2023-velocon/>VeloCON 2023</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/ class="dd-item parent haschildren"><div><i class="fa fa-angle-down fa-sm category-icon"></i>
<a href=/docs/><i class="fas fa-book-reader"></i>Documentation</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/overview/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/overview/>Velociraptor Overview</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/overview/history/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/history/>History</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/overview/support/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/overview/support/>Support Policy</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/deployment/>Deployment</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/deployment/self-signed/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/self-signed/>Self-Signed SSL</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/cloud/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/deployment/cloud/>Cloud Deployment</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/deployment/cloud/multifrontend/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/cloud/multifrontend/>Multi-Frontend</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/clients/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/clients/>Deploying Clients</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/rbac/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/rbac/>Users and Roles</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/resources/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/resources/>Performance</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/troubleshooting/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/troubleshooting/>Troubleshooting</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/deployment/references/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/deployment/references/>Config Reference</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/gui/>The Admin GUI</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/gui/clients/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/clients/>Inspecting clients</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/vfs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/vfs/>The VFS</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/artifacts/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/artifacts/>Artifacts</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/gui/hunting/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/gui/hunting/>Hunting</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/vql/>VQL Fundamentals</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/vql/notebooks/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/notebooks/>Notebooks</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/artifacts/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/artifacts/>Artifacts</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/vql/events/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/vql/events/>Event Queries</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/forensic/>Forensic Analysis</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/forensic/filesystem/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/filesystem/>Searching Filenames</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/searching/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/searching/>Searching Content</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/ntfs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/ntfs/>NTFS Analysis</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/binary/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/binary/>Binary parsing</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/evidence_of_execution/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/evidence_of_execution/>Evidence Of Execution</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/event_logs/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/event_logs/>Event Logs</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/forensic/volatile/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/forensic/volatile/>Volatile State</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/offline_triage/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/offline_triage/>Triage and acquisition</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/offline_triage/remote_uploads/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/offline_triage/remote_uploads/>Remote Uploads</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/docs/client_monitoring/ class="dd-item active"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/client_monitoring/>Client Monitoring</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/extending_vql/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/extending_vql/>Extending VQL</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/server_automation/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/docs/server_automation/>Server Automation</a></div><ul><li data-nav-id=https://docs.velociraptor.app/docs/server_automation/server_api/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/server_automation/server_api/>Server API</a></div></li><li data-nav-id=https://docs.velociraptor.app/docs/server_automation/server_monitoring/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/docs/server_automation/server_monitoring/>Server Monitoring</a></div></li></ul></li></ul></li><hr><li data-nav-id=https://docs.velociraptor.app/vql_reference/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/vql_reference/><i class="fas fa-book"></i>VQL Reference</a></div><ul><li data-nav-id=https://docs.velociraptor.app/vql_reference/basic/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/basic/>Basic VQL</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/linux/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/linux/>Linux Specific</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/windows/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/windows/>Windows Specific</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/parsers/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/parsers/>Parsers</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/server/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/server/>Server Side</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/plugin/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/plugin/>Client Side</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/event/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/event/>Event Plugins</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/experimental/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/experimental/>Experimental</a></div></li><li data-nav-id=https://docs.velociraptor.app/vql_reference/misc/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/vql_reference/misc/>Misc</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/training/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/training/><i class="fas fa-graduation-cap"></i>Training</a></div></li><li data-nav-id=https://docs.velociraptor.app/blog/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/blog/><i class="fas fa-newspaper"></i>Blog</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/ class="dd-item haschildren"><div><i class="fa fa-angle-right fa-sm category-icon"></i>
<a href=/presentations/><i class="fas fa-chalkboard-teacher"></i>Presentations</a></div><ul><li data-nav-id=https://docs.velociraptor.app/presentations/2022_linuxconf_au/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_linuxconf_au/>Linux Conf Au 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_auscert/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_auscert/>Auscert 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_dfrws_us/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_dfrws_us/>DFRWS US 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_tech_user_group_cbr/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_tech_user_group_cbr/>Tech Users Group 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_sans_summit/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_sans_summit/>SANS Summit 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_velocon/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_velocon/>Velocon 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2022_dfrws_apac/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2022_dfrws_apac/>DFRWS APAC 2022</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2023_everything_open/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2023_everything_open/>EverythingOpen 2023</a></div></li><li data-nav-id=https://docs.velociraptor.app/presentations/2023_auscert/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/presentations/2023_auscert/>Auscert 2023</a></div></li></ul></li><li data-nav-id=https://docs.velociraptor.app/exchange/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/exchange/><i class="fas fa-code"></i>Artifact Exchange</a></div></li><li data-nav-id=https://docs.velociraptor.app/artifact_references/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/artifact_references/><i class="fas fa-book"></i>Artifact Reference</a></div></li><li data-nav-id=https://docs.velociraptor.app/knowledge_base/ class="dd-item haschildren"><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/knowledge_base/><i class="fas fa-brain"></i>Knowledge Base</a></div></li><li data-nav-id=https://docs.velociraptor.app/search/ class=dd-item><div><i class="fa fa-circleXX fa-sm category-icon"></i>
<a href=/search/><i class='fas fa-search'></i>Search</a></div></li></ul><hr><section id=shortcuts><h3></h3><ul><li><a class=padding href=https://github.com/Velocidex/velociraptor><i class='fab fa-github'></i>Github</a></li><li><a class=padding href=https://docs.velociraptor.app/discord/><i class='fab fa-discord'></i>Discord</a></li><li><a class=padding href=mailto:velociraptor-discuss@googlegroups.com><i class='fas fa-envelope'></i>Mailing List</a></li><li><a class=padding href=https://docs.velociraptor.app/rss/><i class='fas fa-rss'></i>RSS</a></li></ul></section><section id=footer><div class=footer-copyright>Brought to you by
<img src=/images/Rapid7_logo.svg class=rapid7><br><i class="fas fa-copyright"></i> 2022</div></section></div></nav><script>$("#sidebar i.fa-angle-right").each(function(){$(this).parent().parent().find("ul").hide()})</script><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title='Edit this page' href=https://github.com/Velocidex/velociraptor-docs/edit/master/content/docs/client_monitoring/_index.md target=blank><i class="fas fa-code-branch"></i>
<span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span>
<span id=toc-menu><i class="fas fa-list-alt"></i></span>
<span class=links>Client Monitoring</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><a href=#client-monitoring-architecture>Client monitoring architecture</a></li><li><a href=#installing-client-event-queries>Installing client event queries.</a></li><li><a href=#selecting-event-artifacts-to-apply>Selecting event artifacts to apply</a></li><li><a href=#inspecting-the-current-monitoring-table>Inspecting the current monitoring table</a></li><li><a href=#viewing-collected-events>Viewing collected events.</a></li><li><a href=#further-processing-client-monitoring-events>Further processing client monitoring events.</a></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Client Monitoring</h1><p>We have previously seen the VQL <a href=/docs/vql/events/>Event Queries</a> are simply VQL queries that never terminate,
generating a row for each event that occurs.</p><p>We can use this property to monitor for events on the endpoint. In
order to build an effective client monitoring framework we need three
components:</p><ol><li><p>A number of event plugins that can detect events on the
endpoint. For example, <code>watch_etw()</code> allows Velociraptor to monitor
ETW events on Windows, <code>watch_syslog()</code> allows following syslog
events on Linux etc.</p></li><li><p>Once events are detected by VQL plugins, we can use the rest of the
VQL query to post process these events by applying further
filtering or enriching with additional data.</p></li><li><p>Finally a client monitoring architecture must be used to ensure
event queries are always running and forward these events to the
server.</p></li></ol><p>In this page we discuss the client monitoring architecture and
demonstrate how it can be used to feed events from the endpoint to the
server.</p><div class="mynotices tip"><div heading=tip><p>VQL event plugins generally start with the word &ldquo;watch&rdquo; to indicate
they are event plugins (e.g. <code>watch_etw</code>, <code>watch_evtx</code>, <code>watch_usn</code>
etc). Sometimes there will be a related non-event plugin for example
<code>parse_evtx()</code> simply parses the event log file beginning to end,
while <code>watch_etvx()</code> watches the file for new events and does not
terminate.</p><p>You can search for all plugins on the <a href=/vql_reference/>VQL Reference page</a>, so simply read about all available event queries <a href=/vql_reference/event/>here</a>.</p></div></div><h2 id=client-monitoring-architecture>Client monitoring architecture</h2><p>The client maintains a set of VQL Event Queries that are all run in
parallel. This is called the <code>Client's Event Table</code> and it gets synced
from the server when needed. The client writes these Event Queries in
the <code>writeback file</code> so they become available as soon as the client
starts - even when not online!</p><p>If the client is offline, these will be queued in the clientâ€™s local
file buffer, until the client reconnects again, at which time they are
synced back to the server. This architecture ensures that clients can
not lose events, event when not online. It also means that clients are
able to monitor for events autonomously - the server is only needed to
refresh the client&rsquo;s event tables.</p><p>When any of these produce rows, the client streams the events to the
server which in turn, writes them to the filestore.</p><p><figure><img src=client_events_arch.png alt="Client Event Architecture" class=captioned><figcaption>Client Event Architecture</figcaption></figure></p><h2 id=installing-client-event-queries>Installing client event queries.</h2><p>Each client has a set of event queries that it is constantly running
called an <code>Event Table</code>. The server can update the client&rsquo;s event
tables based on client labels:</p><ul><li><p>Event Artifacts within label group &ldquo;All&rdquo; apply to all clients
regardless of label or OS type (Note that artifact preconditions are
still honored).</p></li><li><p>Event Artifacts can target specific label groups. If the client has
that label applied, the event table for that client will include
these event artifacts as well.</p></li></ul><p><figure><img src=updating_client_events.png alt="Update client events" class=captioned><figcaption>Update client events</figcaption></figure></p><div class="mynotices tip"><div heading=" Controlling event queries on clients using labels "><p>Note that label group membership is dynamic - clients may be added or
removed from label groups at any time by simple applying or remove the
relevant label. Applying a label to a client automatically updates the
client event monitoring queries as well.</p><p>In this way it is possible to move clients into label groups that
require different monitoring queries - for example perhaps you wish to
monitor only some of your end points for powershell or psexec
executions some of the time, simply apply the relevant label.</p></div></div><h2 id=selecting-event-artifacts-to-apply>Selecting event artifacts to apply</h2><p>Velociraptor uses an &ldquo;Artifact&rdquo; to package VQL queries in a structured
YAML file. Event queries are no different - they are contained within
<code>Event Artifacts</code>. In the next step we can select which artifacts will
be applied to this label group.</p><p>For this example, we select the <code>Windows.ETW.DNS</code> artifact to collect
DNS lookup from clients.</p><p><figure><img src=dns_monitoring.png alt="Monitoring for DNS lookups" class=captioned><figcaption>Monitoring for DNS lookups</figcaption></figure></p><div class="mynotices note"><div heading=" Searching for artifact "><p>While the artifact selection UI might look very similar to the new
collection UI or new hunt UI, the main difference is that the artifact
selection UI in the Event selection workflow only shows event
artifacts.</p><p>Event artifacts are identified by their <code>type: CLIENT_EVENT</code> entry in
the definition YAML.</p><p>If you add a new event artifact, be sure to designate it as a
CLIENT_EVENT type or else it will not appear in the UI and the user
can not select it.</p></div></div><h2 id=inspecting-the-current-monitoring-table>Inspecting the current monitoring table</h2><p>The current configuration can be viewed by simply clicking the &ldquo;Show
client monitoring table&rdquo; button.</p><p><figure><img src=inspecting_table.png alt="Inspecting client monitoring table" class=captioned><figcaption>Inspecting client monitoring table</figcaption></figure></p><h2 id=viewing-collected-events>Viewing collected events.</h2><p>Once the client syncs its client monitoring table, it will start
forwarding events to the server. Events are simply rows returned by
the VQL query. The server simply stores these rows in the filestore
and provides a timeline based UI to inspect the data.</p><p><figure><img src=viewing_client_events.png alt="Viewing client events" class=captioned><figcaption>Viewing client events</figcaption></figure></p><p>The view is split into two halves. The top half is the timeline view
while the bottom half is the table view. The events can be viewed in
the table, while the timeline view provides a quick way to navigate
different time ranges.</p><p>You can see the timeline view is split into three rows:</p><ol><li><code>Table View</code> visualizes the time range visible in the table currently.</li><li><code>Available</code> shows the days which have any events in them.</li><li><code>Logs</code> visualizes the days that have any logs in them (You can view query logs by selecting the <code>Logs</code> pull down on the top right).</li></ol><p>In order to keep the table brief the timestamps are abbreviated - you
can hover the mouse over those to get the full timestamp. Usually the
exact timestamp in the table is not important as we can see a
visualization of the time range in the timeline above.</p><p>You can zoom in and out of the visible time ranges using <code>Ctrl-Mouse Wheel</code> or by clicking the timeline itself.</p><p><figure><img src=event-monitoring-1.png alt="Interacting with the timeline" class=captioned><figcaption>Interacting with the timeline</figcaption></figure></p><p>By clicking the tool bar it is possible to page through the table to
view visible events. If you need to export the data, simply click the
<code>Export</code> button and select either JSON or CSV format. The export
functionality applies to the visible time range so you can finely tune
which events should be exported (simply zoom the visible range in or
out).</p><div class="mynotices note"><div heading=" Client side buffering "><p>Although VQL queries emit rows in real time, Velociraptor does not
forward the event row immediately to the server. This is done to avoid
too-frequent communications with the server. Instead, the client will
batch rows in memory (by default for 120 seconds) and send them in a
single POST upload. This means that it could take up to 2 minutes for
events to appear at the server once a new client event table is
installed.</p></div></div><h2 id=further-processing-client-monitoring-events>Further processing client monitoring events.</h2><p>Client event queries simply run on the endpoint and forward rows to
the server. The event queries generally fall into two types:</p><ol><li><p>Collecting real time data such as ETW logs, process executions
logs, Sysmon logs etc. These are typically collected by
Velociraptor and sent directory to an external system (e.g. Elastic
or Splunk). Typically the VQL for such queries contains minimal
filtering and simply forwards all events to the server.</p></li><li><p>Selective and targeted queries. These artifacts contain refined
detection and enrichment log within the VQL query itself such that
only high value events are actually forwarded. These more targeted
queries send few rows but when an event is detected, it probably
should be escalated.</p></li></ol><p>In either case, Velociraptor itself does not do anything with the
events collected by default, other than write them to storage. Further
server side processing is needed using <a href=/docs/server_automation/server_monitoring/>server side event queries</a>.</p><footer class=footline></footer></div></div><div id=navigation></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1683470635></script>
<script src=/js/perfect-scrollbar.min.js?1683470635></script>
<script src=/js/perfect-scrollbar.jquery.min.js?1683470635></script>
<script src=/js/jquery.sticky.js?1683470635></script>
<script src=/js/featherlight.min.js?1683470635></script>
<script src=/js/highlight.min.js?1683470635></script>
<script>hljs.highlightAll()</script><script src=/js/modernizr.custom-3.6.0.js?1683470635></script>
<script src=/js/learn.js?1683470635></script>
<script src=/js/hugo-learn.js?1683470635></script></body></html>